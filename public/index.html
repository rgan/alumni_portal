<head>
    <script type="text/javascript" src="javascripts/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="javascripts/jquery.tmpl.js"></script>
    <script type="text/javascript" src="javascripts/knockout-1.2.1.js"></script>
</head>
<body>
<h2>Alumni Portal</h2>

<div id="form">
    <p>First name:<input data-bind="value: first_name"></span></p>

    <p>Last name:<input data-bind="value: last_name"></span></p>

    <p>Speciality:<input data-bind="value: specialty"></span></p>

    <p>UG college:<input data-bind="value: ug_college"></span></p>

    <p>PG college:<input data-bind="value: pg_college"></span></p>
    <button data-bind="click: addAlumnus">Save</button>
</div>

<div id="search"><input id="searchText">
    <button data-bind="click:searchAlumni">Search</button>

    <div data-bind="template: { name:'alumniTemplate', data: alumni}">
    </div>

</div>

<script id="alumniTemplate" type="text/html">
    <h4>Results:</h4>
    <table width="100%">
        <tr>
            <td>First Name</td>
            <td>Last Name</td>
            <td>Specialty</td>
            <td>UG College</td>
            <td>PG College</td>
        </tr>
        {{each $data}}
        <tr>
            <td>${first_name}</td>
            <td>${last_name}</td>
            <td>${specialty}</td>
            <td>${ug_college}</td>
            <td>${pg_college}</td>
        </tr>
        {{/each}}
    </table>
</script>

<script type="text/javascript">

    var viewModel = {
        first_name : ko.observable(""),
        last_name : ko.observable(""),
        ug_college : ko.observable(""),
        pg_college : ko.observable(""),
        specialty : ko.observable(""),
        addAlumnus: function() {
            $.ajax({
                url: "alumni.json",
                type: "post",
                data: ko.utils.stringifyJson({ "alumnus" : JSON.parse(ko.toJSON(this)) }), // this is needed because ko.toJS() does not seem to work
                contentType: "application/json",
                success: function(result) {
                    viewModel.first_name("");
                    viewModel.last_name("");
                    viewModel.ug_college("");
                    viewModel.pg_college("");
                    viewModel.specialty("");
                }
            });
        }

    };

    var searchViewModel = {
        alumni: ko.observableArray([])
    };

    searchViewModel.searchAlumni = function() {
        $.ajax({
            url: "/alumni/search/" + $("input[id='searchText']").val() + ".json",
            type: "get",
            contentType: "application/json",
            success: function(result) {
                result.forEach(function(item) {
                    searchViewModel.alumni.push(item);
                });
            }
        });
    };

    ko.applyBindings(viewModel, $("#form")[0]);
    ko.applyBindings(searchViewModel, $("#search")[0]);

</script>
</body>